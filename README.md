# Benchmarking Test App

## Overview

Benchmarking test app provides a simple harness for running React Native benchmarks on a real mobile device. The repository currently supports iOS benchmarks via Appium, and can be easily extended to support Android or any other platform supported by Appium and React Native. In this repository you'll find a few packages:

- `apps/benchmarking-test-app`: A React Native app with built-in benchmarks for bitECS, three.js, and ir-engine.
- `packages/benchmarking`: An Appium harness for running benchmarks within AWS device farm.
- `packages/benchmark-parser`: A utility library for parsing benchmark files generated for the app from AWS device farm.

There are currently two classes of benchmarks generated by the benchmarking test app: Xcode profiles and wall clock time benchmarks. The wall clock time benchmarks serve as a regression test for the benchmarks, tracking the performance of the profiled libraries over time, with results posted to: https://rebeckerspecialties.github.io/benchmarking-test-app/dev/bench/. When regressions happen, the Xcode instruments profiles can be used to dig into the root cause of the performance issues.

## Using this repository

The benchmarks in this repository measure the performance of various Entity Component System (ECS) libraries and JavaScript graphics engines. However, the benchmarking test app can easily be used to profile any JavaScript code, and can even be extended to profile native modules. Anyone can use this repository as a template to create their own benchmark suite for their device test cloud setup.

We do not currently have a contribution guide or staffing to accept contributions, but it would make sense to set up extensions for running Android, Windows, and Mac benchmarks on a variety of test clouds. The repository is currently set up to run benchmarks on AWS, but it could be used on Firebase test lab with some wrangling.

## Running benchmarks on a local device

In order to build and run the benchmarks on a local test device with Appium, there are a few prerequisistes:

### General Development

1. Install node and npm

We recommend installing node with Node Version Manager (nvm): https://github.com/nvm-sh/nvm. This repository supports Node 20+

2. Install dependencies

```
npm install -w benchmarking-test-app
```

### Appium setup

1. Install Appium

```
npm i --location=global appium
```

2. Install the xcuitest driver for Appium

This allows Appium to run tests on an iOS device

```
appium driver install xcuitest
```

3. Run appium driver doctor to ensure that all dependencies are installed

```
appium driver doctor xcuitest
```

4. (Optional) Install the uiautomator2 driver for Appium

This allows Appium to run tests on an Android device. Android is not fully supported, but there is only iOS specific appium code in the xcode instruments profiling benchmarks.

```
appium driver install uiautomator2
appium driver doctor uiautomator2
```

5. Run appium

Run appium with the desired capabilities. the `udid` option can be omitted if using a simulator.

```
appium --relaxed-security --default-capabilities \
  "{\"appium:deviceName\": \"<Your device name here>", \
  \"platformName\": \"iOS", \
  \"appium:app\": \"com.rbckr.TestApp", \
  \"appium:udid\":\"<Your device's udid>", \
  \"appium:automationName\": \"XCUITest\"}"
```

### iOS Development (Mac Required)

1. Install/update Cocoapods

CocoaPods is installed by default on all Macs, but it may be out of date. Follow the instructions here: https://guides.cocoapods.org/using/getting-started.html to update Cocoapods. Cocoapods is used to manage native libraries for Xcode builds.

2. Install/update Xcode

Xcode is required for building iOS apps from native code. Download Xcode and Xcode command line tools from https://developer.apple.com/xcode/resources/

3. Install React Native pods for Hermes

```
cd apps/benchmarking-test-app
npm run install:ios:hermes
```

4. Connect an iOS device (or use an Xcode simulator)

5. Launch the benchmarking test app on the device

```
cd apps/benchmarking-test-app
npm run ios
```

### Android Development

**_ UNDER CONSTRUCTION _**

## AWS Device Farm setup

### Creating a Device Farm project

## Adding a benchmark
